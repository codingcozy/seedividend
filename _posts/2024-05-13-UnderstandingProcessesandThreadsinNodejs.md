---
title: "Nodejs에서 프로세스와 스레드 이해하기"
description: ""
coverImage: "/assets/img/2024-05-13-UnderstandingProcessesandThreadsinNodejs_0.png"
date: 2024-05-13 00:19
ogImage: 
  url: /assets/img/2024-05-13-UnderstandingProcessesandThreadsinNodejs_0.png
tag: Tech
originalTitle: "Understanding Processes and Threads in Node.js"
link: "https://medium.com/@danish512/understanding-processes-and-threads-in-node-js-477d1449b12b"
isUpdated: true
---





![Understanding Processes and Threads in Node.js](/assets/img/2024-05-13-UnderstandingProcessesandThreadsinNodejs_0.png)

Node.js는 주로 단일 쓰레드 이벤트 루프 모델에서 작동합니다. 이는 코드가 한 번에 한 가지 작업만 수행할 수 있다는 것을 의미합니다. 그러나 Node.js는 또한 libuv와 같은 라이브러리를 통해 파일 읽기와 같은 I/O 작업과 같은 특정 작업을 백그라운드 쓰레드로 제공합니다. 이러한 백그라운드 쓰레드는 파일 I/O, 네트워크 요청 및 DNS 조회와 같은 작업을 처리하여 주 쓰레드가 다른 이벤트를 계속 처리할 수 있도록 합니다.

# 프로세스

프로세스는 운영 체제에서 실행 중인 프로그램입니다. 각 프로세스는 자체 메모리를 가지며 다른 실행 중인 프로그램의 메모리에 접근할 수 없습니다. 무한 루프가 있는 노드 프로그램을 만들어 실행했을 때 종료되지 않도록 만들어 봅시다.



`process.js` 라는 파일을 만들어서 다음 코드를 입력해 주세요:

```js
const process_name = process.argv.slice(2)[0];
let count = 0;
while (true) {
  count++;
  if (count === 200 || count === 400) {
    console.log(`${process_name}: ${count}`);
  }
}
```

다음 명령어를 사용하여 이 프로그램을 실행해 봅시다. Node.js 명령어를 사용해주세요:

```js
node process.js A &
```



A는 프로그램에 전달되어 process_name 변수에 저장되는 명령행 인수입니다. 끝의 &는 Node 프로그램을 백그라운드에서 실행할 수 있게 해서 쉘에서 더 많은 명령을 입력할 수 있도록 합니다.

```js
출력
[1] 15228
A: 200
A: 400
```

숫자 7754는 운영 체제가 할당한 프로세스 ID입니다. A: 200 및 A: 400은 프로그램의 출력입니다.

node 명령을 사용하여 프로그램을 실행할 때(사용하는 것이 Node.js를 가정합니다), 프로세스가 생성됩니다. 운영 체제는 프로그램을 위한 메모리를 할당하고, 컴퓨터 디스크에서 프로그램 실행 파일을 찾아 메모리에 로드하는 작업 등을 처리합니다. 이후, 프로그램에 프로세스 ID(PID)를 할당하고 실행을 시작합니다. 이 단계에서 프로그램이 프로세스가 됩니다.



Node 프로세스를 빠르게 요약하려면:

```js
ps |grep node
```

```js
출력
15228 pts/1    00:00:15 node
```

하나의 프로그램에서 여러 프로세스를 만들 수 있습니다. 예를 들어, 다음 명령을 사용하여 서로 다른 인수로 세 개의 추가 프로세스를 만들고 백그라운드에 넣을 수 있습니다:



```js
node process.js B & node process.js C & node process.js D &
```

위 명령을 실행한 후에 출력은 아래와 유사할 수 있지만 순서가 달라질 수 있습니다:

```js
Output:
[1] 15925
[2] 15926
[3] 15927
B: 200
C: 200
B: 400
D: 400
C: 400
D: 400
```

출력을 주의 깊게 살펴보면 실행 순서가 고정되어 있지 않다는 것을 알 수 있습니다. B, C, D 순으로 시작했지만 다른 순서로 끝날 수 있습니다. 이 동작의 이유는 OS가 각 프로세스를 실행할 때 결정하는 스케줄링 알고리즘 때문입니다.



단일 코어 머신에서는 프로세스가 동시에 실행됩니다. 이것은 OS가 프로세스 간을 일정 간격으로 전환하는 것을 의미합니다. 예를 들어, 프로세스 D가 일정 시간 동안 실행되고 나서 그 상태가 어딘가에 저장되고 OS가 프로세스 B를 실행할 때까지 일정 시간을 예약합니다. 이 작업은 모든 작업이 완료될 때까지 계속해서 번갈아가며 반복됩니다. 결과적으로 각 프로세스가 완료된 것처럼 보일 수 있지만 실제로는 OS 스케줄러가 계속해서 그 사이를 전환합니다.

4코어(다중 코어) OS에서는 OS가 각 프로세스를 동시에 각 코어에서 실행하기 위해 예약합니다. 이를 병렬 처리라고 합니다. 그러나 4개의 프로세스(총 8개 프로세스)를 생성하면 각 코어가 완료될 때까지 두 개의 프로세스를 동시에 실행합니다.

현재 실행 중인 모든 Node 프로세스를 kill 명령어로 중지하려면:

```js
sudo kill -9 `pgrep node`
```



# 쓰레드

Node.js의 쓰레드는 프로세스와 유사하지만, 하나의 프로세스의 메모리 내에서 작동합니다. 프로세스는 자체 메모리 공간을 갖지만, 각 쓰레드는 부모 프로세스의 메모리를 공유합니다. Node.js에서 프로세스를 생성할 때 worker_threads 모듈을 사용하여 JavaScript 작업을 동시에 실행할 수 있는 여러 쓰레드를 생성할 수 있습니다. 쓰레드는 메시지 전달을 통해 서로 통신하거나 프로세스의 메모리에서 데이터를 공유하여 작동합니다. 프로세스와는 달리 쓰레드를 생성하는 것은 운영 체제에서 추가적인 메모리를 필요로하지 않아 가벼우며 작업을 병렬로 실행하는 데 효율적입니다.

쓰레드를 실행할 때, 그들은 프로세스와 유사하게 작동합니다. 단일 코어 시스템에서 다중 쓰레드가 있는 경우, 운영 체제는 정기적으로 그들 사이를 전환하여 각 쓰레드가 단일 CPU에서 직접 실행될 수 있도록 합니다. 반면에, 다중 코어 시스템에서는 운영 체제가 모든 코어에 걸쳐 쓰레드를 스케줄링하여 JavaScript 코드가 동시에 실행되도록 합니다. 사용 가능한 코어보다 더 많은 쓰레드가 생성된 경우, 각 코어는 여러 쓰레드를 동시에 처리하여 리소스 사용을 최적화합니다.

# 숨겨진 Node.js의 쓰레드



Node.js는 종종 "멀티스레드"라고 불리는데, 이는 입력/출력(I/O) 작업을 더 효율적으로 처리하기 위해 추가 스레드를 활용하기 때문입니다. 작동 방식은 다음과 같아요:

소개에서 설명한 대로, JavaScript 자체는 단일 스레드이므로 한 번에 한 가지 작업을 처리합니다. 프로그램이 파일을 읽거나 네트워크 요청을 하려고 할 때, 이러한 작업이 끝날 때까지 대기하여 주 스레드를 차단시킬 수 있습니다.

그러나 Node.js는 libuv 라이브러리를 구현하여 4개의 추가 스레드를 Node.js 프로세스에 제공합니다. 이러한 스레드를 사용하여 I/O 작업이 따로 처리되며, 작업이 완료되면 이벤트 루프는 해당 I/O 작업에 연결된 콜백을 마이크로태스크 큐에 추가합니다. 주 스레드의 호출 스택이 비어있을 때, 콜백이 호출 스택에 푸시되어 실행됩니다. 명확히 하자면, 주어진 I/O 작업에 대한 콜백이 병렬로 실행되지는 않지만, 파일을 읽거나 네트워크 요청하는 작업 자체가 스레드의 도움으로 병렬로 실행됩니다. I/O 작업이 끝나면 해당 콜백이 주 스레드에서 실행됩니다.

이 4개의 스레드 외에도 V8 엔진은 자동 가비지 수집과 같은 작업을 처리하기 위한 추가 2개의 스레드를 제공합니다.



노드 프로세스마다 총 일곱 개의 스레드가 있다는 내용입니다. 우리가 process.js 파일을 다시 실행하고 백그라운드에서 돌리는 것으로 이를 확인해보겠습니다:

```js
node process.js A &
```

이제 스레드를 확인하기 위해 top 명령어를 사용하여 프로세스 ID를 전달하겠습니다.

```js
top -H -p 19821
```



위의 명령을 실행하면, 출력물은 다음과 유사할 것입니다:

![Image](/assets/img/2024-05-13-UnderstandingProcessesandThreadsinNodejs_1.png)

출력물에서 보듯이, Node.js 프로세스에는 총 일곱 개의 스레드가 있습니다: 자바스크립트를 실행하는 주 스레드 하나, 네 개의 Node.js 스레드, 그리고 두 개의 V8 스레드가 있습니다.