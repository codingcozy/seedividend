---
title: "우리가 AWS를 떠나 1백만 달러에서 20만 달러로 80 절감한 연간 서버 비용 경험 공유"
description: ""
coverImage: "/assets/img/2024-05-14-Howwereducedourannualservercostsby80from1Mto200kbymovingawayfromAWS_0.png"
date: 2024-05-14 13:00
ogImage: 
  url: /assets/img/2024-05-14-Howwereducedourannualservercostsby80from1Mto200kbymovingawayfromAWS_0.png
tag: Tech
originalTitle: "How we reduced our annual server costs by 80% — from $1M to $200k — by moving away from AWS"
link: "https://medium.com/gitconnected/how-we-reduced-our-annual-server-costs-by-80-from-1m-to-200k-by-moving-away-from-aws-2b98cbd21b46"
---


## Prerender의 기술 리드이자 총괄 매니저 인 Zsolt Varga와의 인터뷰

![이미지](/assets/img/2024-05-14-Howwereducedourannualservercostsby80from1Mto200kbymovingawayfromAWS_0.png)

이번 주에 Prerender.io의 기술 리드 및 매니저 인 Zsot Varga와 인터뷰했습니다. 그는 Prerender가 AWS에 의존하지 않고 인프라를 직접 구축하여 트래픽 및 캐시된 데이터를 처리함으로써 80만 달러를 절약한 경험을 공유했습니다.

## Prerender와 해결하고 있는 가장 흥미로운 기술적 문제를 설명해 줄 수 있나요?



간단히 말해서, 프리렌더는 JavaScript 페이지를 캐시하고 사이트에 적절한 미들웨어가 설치된 상태로 검색 엔진이 순수한 HTML 파일을 크롤링하고 인덱싱할 수 있도록 해줍니다. 이를 통해 사용자들이 비실용적이고 시간이 많이 소요되는 JavaScript 우회 방법으로 번거로움을 겪지 않게 됩니다.

그러나 이 모든 데이터와 프로세스는 서버에서 발생해야 하며 물론, 우리는 AWS를 사용했습니다. 몇 년간의 성장 이후, 우리는 분당 7만 페이지 이상을 처리하며, 약 5억 6천만 페이지를 저장하고 있으며, 연 당 100만 달러 이상을 지불하고 있습니다.

물론 AWS에 머무른다면 그만큼 많은 비용이 발생할 것입니다. 대신, 우리는 아웃 오브 더 박스 사고와 명확한 계획을 통해 3개월도 안 되어 80% 비용을 절감할 수 있었습니다. 여러분도 다음과 같이 할 수 있습니다.

## 이주 계획: 단계별 안내



최근까지 Prerender는 클라이언트들을 위해 캐시하고 렌더링하는 페이지를 Amazon Web Services (AWS)에서 호스팅하는 서버와 서비스를 사용했습니다. AWS는 최대 규모의 클라우드 제공업체 중 하나로, 가상 서버와 관리 서비스를 제공합니다.

이전까지 Prerender는 Google, Facebook 또는 다른 콘텐츠를 색인화하려는 봇/스파이더에 의해 가져가기 준비가 된 때까지 캐시를 저장하는 데 AWS를 사용해왔습니다. 이것은 Prerender의 기능 중 상당 부분을 차지하며, Google 및 다른 검색 엔진에 정적 HTML을 제공하고 인간 사용자에게 동적인 상호작용형 JavaScript를 제공했습니다.

문제는 무려 테라바이트 단위의 사전 렌더링된 웹 페이지 콘텐츠를 3자 서버에 이렇게 저장하는 것이 매우 비용이 많이 든다는 것이었습니다. 이 방식으로 캐시된 페이지를 저장하는 것은 Prerender에게 유지 및 호스팅 비용만으로 엄청나게 많은 비용이 들었습니다.

하지만 이것은 고려해야 할 또 다른 함정이 있었고, 많은 스타트업들이 고려하지 않는 것이며 그에 대한 논의가 많이 부족한 문제: 트래픽 비용입니다.



AWS로 데이터를 가져 오는 것은 기술적으로 무료이지만, 대부분의 소프트웨어에 정적 데이터가 어떻게 유용한가요? 데이터를 이동하면 Prerender에게는 엄청난 비용이 들었고, 우리는 우리를 제한하고 있는 병목 현상에 대해 알아차리기 시작했습니다.

해결책은 무엇이었나요? 캐시된 페이지와 트래픽을 Prerender의 내부 서버로 이전하고 AWS에 대한 의존도를 최대한 빨리 줄이는 것이었습니다.

비용 예측을 하자, 호스팅 비용을 40% 줄일 수 있을 것으로 추정하고, 서버 이전을 통해 Prerender와 고객의 비용을 모두 줄일 수 있을 것으로 결정했습니다.

목표는 비용을 줄이면서 렌더링 속도와 서비스 품질을 동일하게 유지하는 것이었습니다. 이러한 이주는 신중하게 계획되고 실행되어야 하며, 잘못된 구성 또는 잘못된 실행이 고객 웹 페이지 및 소셜 미디어 클릭의 다운 타임을 초래하고 검색 순위에 영향을 미칠 수 있으며, 우리의 이탈률을 증가시킬 수 있습니다.



잠재적인 결과를 완화하기 위해 이전 단계로 쉽게 되돌아갈 수 있는 3단계 과정을 계획했습니다. 새 서버가 작동하지 않는 경우를 대비해 변경 사항을 쉽게 롤백하여 고객에게는 고객에게 눈에 띄지 않는 다운타임이나 서비스 저하가 발생하지 않습니다.

계속적이고 체계적인 테스트의 주요 한계는 수주 및 수개월에 걸쳐 진행된다는 것입니다.

# AWS에서 Prenderer 이동: 주간 개요

## 1단계 — 테스트 (4~6주)



Phase 1은 주로 베어 메탈 서버를 설정하고 스케일링하기 전에 작은 규모에서 마이그레이션을 시험해 보는 것을 포함했습니다. 이 단계에서는 소프트웨어를 최소한으로 적용하여 Linux의 KVM 가상화에서 실행하기로 결정했습니다.

5월 초에는 첫 번째 일괄 서버가 가동되었고 Prerender 트래픽의 1%가 새로운 서버로 전달되었습니다. 마이그레이션 시작 후 2주 만에 하루에 800달러를 절약하고 있었습니다. 한 달이 끝날 때쯤에는 대부분의 트래픽 워크로드를 AWS로부터 이전하여 일일 Chrome 렌더링 워크로드 비용을 45%로 줄였습니다.

서버 비용 부분에서 현재 우리의 비용은 월 13,000달러입니다. AWS와 결합하여 이미 비용을 22% 절감했습니다.

![이미지](/assets/img/2024-05-14-Howwereducedourannualservercostsby80from1Mto200kbymovingawayfromAWS_1.png)



테스트 단계가 매끄럽게 진행될 수 있도록 중요했습니다. 더 많은 모니터링 및 더 나은 오류 처리로 시스템의 견고성을 향상시키는 데 노력했습니다. 이미 보유하고 있던 서버 모니터링 대시보드 외에도 발생한 오류나 성능 문제를 식별할 수 있는 새로운 렌더링 모니터링 대시보드를 설정했습니다.

![Image](/assets/img/2024-05-14-Howwereducedourannualservercostsby80from1Mto200kbymovingawayfromAWS_2.png)

지속적인 모니터링과 명확한 커뮤니케이션 덕분에 테스트는 성공적이었고, 절약 예산은 초과되었으며 이사의 제2 단계를 시작할 준비가 모두 마련되었습니다.

## 제2 단계 — 기술적인 설정(4 주)



6월 중순부터 7월 초까지의 이관 기간은 대부분 마이그레이션의 첫 단계가 컨셉 검증을 위한 작업으로 기술적인 설정에 사용되었습니다. 두 번째 단계의 구현은 대부분 캐시 저장소를 베어 메탈 서버로 이동하는 작업을 포함했습니다.

6월 중순에 이관이 진행되었을 때, 300대의 서버가 매우 원활하게 작동하며 전체 2억 개의 캐시 페이지가 있었습니다. 각 서버에는 AWS S3와 호환되는 Apache Cassandra 노드를 사용했습니다.

온라인 마이그레이션을 한 단계씩, 한 주 또는 두 주 간격으로 네 단계로 나누어 실행했습니다. Prerender 페이지가 S3와 미니오에서 캐시될 수 있는지 테스트한 후, AWS S3로의 트래픽을 점진적으로 중단하고 미니오로 유도했습니다. S3로의 쓰기가 완전히 중지된 후에는 Prerender가 S3 API 비용을 하루에 200달러 절약하며, 우리의 Cassandra 클러스터에 이미 캐시된 데이터를 삭제할 준비가 되었음을 나타냈습니다.

하지만, 이 단계의 마무리는 6월 24일쯤에 이루어졌습니다. 지난 네 주 동안, 우리는 대부분의 캐시 작업 부하를 AWS S3에서 우리 자체의 Cassandra 클러스터로 옮겼습니다. AWS의 일일 비용이 1.1K 달러로 감소되어 월 35K로 추산되며, 새로운 서버의 월 반복 비용은 약 14K로 추산되었습니다.



이 시점에서 S3에는 하루에 약 60달러가 드는 일부 잔여물이 남아 있었고, 자연스럽게 몇 주 안에 완전히 소멸할 것으로 예상되었습니다. 모든 데이터를 이동하여 즉시 비용을 제로로 줄일 수도 있었지만, AWS에서 데이터를 이동하면 한 번에 5천 달러의 "돈 낭비"가 발생할 것이었습니다.

데이터 이동은 엄청난 병목 현상에 직면하게 될 때입니다. 우리의 신규 CTO(Zsolt Varga)의 말을 빌리자면:

"AWS의 진정한 숨겨진 비용은 트래픽 비용에서 나옵니다. 그들은 합리적인 가격의 저장소를 판매하고 업로드는 무료입니다. 그러나 꺼낼 때는 막대한 비용을 지불해야 합니다.

작은 스타트업에서는 종종 트래픽 비용을 계산하지 않습니다. 비용 중 90%에 해당할 수도 있다는 사실을 인식하지 못합니다"



예를 들어, 미국 서부(오레곤) 지역에 계시면, 1GB당 0.080달러를 내야 하지만, 아시아 태평양(서울) 지역으로 이동하면 1GB당 0.135달러로 올라갑니다.

저희 경우에는 매달 약 3만 달러에서 5만 달러 사이였습니다. 제2단계가 끝나면 월 총 서버 비용을 41.2%로 줄일 수 있었어요.

![이미지](/assets/img/2024-05-14-Howwereducedourannualservercostsby80from1Mto200kbymovingawayfromAWS_3.png)

## 제3단계 — 구현 및 확장 (4~6주)



이 시점에서 이주 작업은 이미 원활하게 진행 중이었고 이미 Prerender가 상당한 금액을 절약하고 있었습니다. 할 일으로 남은 것은 다른 모든 데이터를 네이티브 서버로 이주하는 것뿐이었습니다.

이 단계에서는 Amazon RDS 인스턴스를 Shard 단위로 모두 이동하는 것이 포함되었습니다. 이것이 전체 프로세스 중에서 가장 오류가 발생하기 쉬운 부분이었지만, 이미 많은 양의 데이터가 이주되어 있었기 때문에 어떠한 결멍이나 병목 현상도 전체 이주를 망가뜨리지 않았을 것입니다.

이주 프로세스의 마지막 단계를 큰 그림에서 보면:

- 우리는 캐시된 URL 테이블을 저장하는 PostgreSQL 샤드를 Cassandra로 미러링했습니다.
- 우리는 Cloudflare 로드 밸런서로 서비스.prerender.io를 전환하여 동적 트래픽 분배를 허용했습니다.
- 우리는 새로운 EU Private-recache 서버를 설정했습니다.
- 성능 문제를 해결하기 위해 계속해서 스트레스 테스트를 실시하고 있습니다.



마이그레이션은 결과적으로 대성공을 거뒀습니다. 모든 캐시된 페이지가 리디렉션된 이후에 월간 서버 요금은 초기 추정액 40% 밑으로 내려가 전체 80%까지 감소했습니다.

## 우리가 배운 것

서버 마이그레이션에서는 잘못되거나 일정을 따라가지 못하는 것이 막대한 위험을 안겨 줄 수 있습니다. 그래서 우리는 마이그레이션 각 단계마다 실패 방지장치를 구현하여 무언가 잘못되었을 때 대비할 수 있도록 보장했습니다. 또한 나머지 마이그레이션을 진행하기 전에 소규모로 테스트하여 안전하게 진행할 수 있도록 했습니다.

마이그레이션의 각 단계를 주의 깊게 계획하고, 확장하기 전 각 구현 단계를 테스트하며, 문제가 발생할 경우 오류를 수정하기 쉽도록 만들어 위험을 최소화했습니다. 이렇게 함으로써 서버 비용을 절약하면서 잠재적인 위험을 최소화할 수 있었습니다.



## Prerender가 해결하는 문제에 대해 일하게 된 동기는 무엇이었나요?

웹을 발전시키는 데 도움을 주는 플랫폼에서 일할 생각에 흥분했습니다.

Prerender를 사용하면 고객들이 사용자 경험에 중점을 둔 웹사이트를 제공하고 SEO에 집중하는 대신 고객들에게 최상의 서비스를 제공할 수 있습니다. 지난 몇 년 동안 새로운 랜딩 페이지를 만들 때마다 우리는 항상 최고의 SEO를 얻기 위해 Wordpress를 사용하고 관리 섹션과 같은 색인되지 않은 페이지에만 SPA의 장점을 활용해 왔습니다. 그러나 이제는 과거에 나를 막아 두었던 문제를 해결하는 회사와 함께 일하고 있습니다 :)

## 어떤 기술 스택을 사용하시나요? 그리고 이 스택을 선택한 이유는 무엇인가요?



우리는 JavaScript를 어디서나 사용합니다. JavaScript 렌더링으로 인한 "이슈"들을 해결하기 때문에, 이 분야에서 가능한 한 많은 전문 지식을 쌓고 싶습니다. 그러나 다른 부분들에 대해서는, 빠른 응답과 글로벌 확장성을 위해 CloudFlare의 분산 시스템을 활용하고 있습니다. 또한 우리의 가용성 보증은 Digital Ocean의 클라우드 플랫폼에서 지원받고 있습니다. 우리는 효율성을 극대화하기 위해 다양한 다른 SaaS 제공업체를 활용하고 있습니다.

## 회사가 비전을 달성했을 때 세상이 어떻게 보일 것인가요?

"새로운 사이트에 React를 사용할 수 있을까?"라는 질문이 나오면 "물론!"이라고 대답할 것입니다. 왜냐하면 현재의 마케팅 부서들은 항상 SEO 순위를 낮출 수 있는 것들을 거부하고 있기 때문입니다. 그것이 옳다고 말할 것입니다. 고객들에 대해서는, 심지어 효율성이 1%라도 감소하면, 그들은 광고 예산을 수십만 달러로 증액해야 할 것입니다.

## 당신에게 전형적인 하루는 어떻게 보이나요?



하하, 고객 전화가 많이 오네요! 우리는 헌신적인 팀을 작고 효과적으로 유지하기를 목표로 하고 있어서, 대부분의 시간을 그들과 온보딩 통화에 사용하고 있어요. 그러나 이 일을 하는 건 즐겁죠! 항상 고객들과 대화하고, 그들의 상황에 대해 배우고, 해결책에 대해 이야기하는 걸 좋아해요. 이런 식으로 하니 제 업무가 훨씬 수월해지죠. 우리가 아이디어를 생각할 필요가 없어서, 고객들이 필요한 모든 정보를 우리에게 알려주기 때문이죠. 고객 중심적인 상황이 가장 좋다고 믿고 있어요. 제 목표는 행복한 고객들의 수를 늘리는 거죠.

## 컴퓨터 하드웨어 설정 설명

오, 이건 정말 기사로서 쓸 만한 가치가 있을 것 같아요. 저는 조금은 게이머 같은데요, 집에 전용 서버 8대가 있어요. 하지만 편의상 대부분 맥북에서 작업을 하고 있어요. 그러나 프로그래밍을 할 시간이 생기면 Manjaro가 돌아가는 "작업용" 컴퓨터를 사용해요. 그리고 가끔 나만의 시간을 갖게 되면, 비밀리에 게임을 즐기려고 운영체제가 윈도우인 PC를 가동시켜요. 지금 이 글을 쓰는 순간에는 노트북, 라즈베리파이, 태블릿으로 둘러싸여 있어요.

늦은 밤에 기계를 조립하고 축소된 테스트를 실행하는 것이 제 취미거든요.



## 내 컴퓨터 소프트웨어 설정 설명

VSCode는 저에게 완벽한 솔루션이에요. 프로그래밍 언어에 대해서 그렇게 애정이 없지만, 확장 프로그램을 설치하고 IDE에서 지원하는 코드를 바로 작성할 수 있는 자유를 제공해줘요. 게다가 CoPilot의 베타 그룹에 들어간 운이 있었는데, 이것은 분명한 게임 체인저에요.

소스 제어로는 GitHub이 멋지지만, 다른 솔루션을 무시하지는 않아요. GitLab은 최근 몇 년 동안 정말 멋진 도구로 발전했어요.

메시징 측면에서는 Slack이 여전히 가장 널리 쓰이는 전문적인 선택지라고 생각되고, 그 일을 잘하니까, 다른 것으로 옮겨가야 할 이유가 없어요. 그러나 최근에 Spike라는 매우 흥미로운 소프트웨어를 발견했고, 지난 3개월 동안 이것을 이메일 클라이언트로 사용해왔어요. 회화 스타일로 이메일을 보낼 수 있어서 훨씬 편리해요.



중요한 도구: 도커, 다른 방법이 없어요. 이것이 업계를 가장 좋게 변화시켰어요. 아직도 의존성을 설치하고 패키지 충돌을 해결해야 했던 어두운 옛날을 기억해요…

하지만, 그래도 쿠버네티스가 점차 적응 수준이 비슷해져 가고 있어요.

## 시작 단계의 소프트웨어 엔지니어를 위한 조언이 있나요?

고객과 대화할 때 두려워하지 마세요. 제 경력 동안, 최고의 소프트웨어 엔지니어는 고객과 협력하여 문제를 해결한 분들이었어요. 때로 한 줄의 코드로 고객의 문제를 해결할 수 있다는 것을 배우면 개발 시간을 6개월 이상 줄일 수 있어요. 저는 최고의 엔지니어들은 실제 세계의 문제에 대한 해결책을 창조한다고 생각해요.



## 채용 중이신가요? 어떤 역할을 모집하고 계신가요?

언제나 채용 중이에요! 우리는 항상 새로운 동료들이 의미 있는 역할을 맡고 분명한 기여를 할 수 있는 경우에만 고용하려고 노력해요. 현재까지 우리는 많이 성장했기 때문에 각 부서에서 팀원을 더 모집해야 하는 상황입니다. 그래서 목록으로 나열하는 대신에 저희의 채용 페이지를 확인해주세요 :D https://saas.group/career

## 좀 더 자세히 알고 싶은 경우 어디서 확인할 수 있나요?

저희 사이트인 prerender.io를 확인해보세요! 그리고 prerendering에 대해 어떻게 웹을 변경하는지 궁금하시다면 varga@prerender.io로 이메일을 보내 저와 통화를 나누고 싶다면 언제든지 연락해주세요. 항상 여러분의 상황과 사용 사례에 대해 배우고 싶어하는 마음으로 통화에 참여할 준비를 하고 있어요 ^.^



Zsolt Varga는 12,000개 이상의 기업에서 사용되는 Google에서 추천하는 소프트웨어 도구 Prerender의 총괄 매니저입니다. 이 도구는 검색 엔진이 JavaScript 웹사이트를 더 잘 크롤링하고 인덱싱할 수 있도록 합니다.

# Level Up 코딩

Level Up은 매달 3백만명의 개발자 커뮤니티입니다. 더 많은 정보를 원하거나 스타트업 인터뷰를 읽으려면 팔로우해주세요. 우리는 최고의 스타트업과 가장 혁신적인 기술 기업과 함께 일하고 있어요.🔥

- 개발자이신가요? 최고의 기업들이 여러분을 고용하도록 요청하세요
➡️ Level Up Talent Collective에 가입하기
- ➡️ FAANG 수준의 엔지니어 고용하기
- ➡️ 인터뷰 요청서를 제출하여 귀사를 인터뷰 받을 수 있도록 하세요



우리는 개발자들의 경력 성장을 돕기 위한 무료 도구도 제공해요: 코딩 인터뷰 코스, 자동 이력서 빌더, 포트폴리오 API

우리를 팔로우해요: Twitter | LinkedIn | Newsletter